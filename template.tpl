___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Supabase Writer",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Stape",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASUAAAEsCAMAAACytlWNAAAC9FBMVEVHcEw8yoo9zYw9zo09z44+0Y8/0pA9z449zow7zJI9zIw90I4+0ZBC3ZdA1ZI+z44/1JE/05A+z44+z408y486yYs9zo1B25ZB2pZB2JQ8zIs8y4lC35k+0Y89zo08yow+0Y8+z41A15M8zo0+05E+0Y88zo0+0Y89zo090Ys8zIs/1ZI8zIw8zItB2ZU9z41B3JY9zo0+0I48zo09zIw8y4s8zIw8zYw/05A+0I48zY09zo09zYw/05Eff1MghlgijF0llGMmmmYvq3M2vX85w4UdfVEef1MegVUghFchiVojjl4lk2Iml2QpnWktpW8vrHQysnk1uH03vYE5woU5xoc6xog7yIkff1QeflIfgFQfgVUgglYgg1YghFchhVghh1khiFoiilsjjF0jjl4kj18kkWAkkmElk2IllGImlmQnl2UomGYommcpm2gpnWkpnmoqn2oroGsromwro20spG4tpW8tpnAtp3AtqHEuqXIuqnIvq3MvrHQwrXUwrnUxr3cxsHcysngys3kytHoztXsztns0t3w0uH01uX41un82u382vIA2vYE3voE4wIM4woQ6xIY6xYc7x4g7yIk7yYo9zIw9zo0hhlgii1wxsXg0tnw1un44wYQ5woU5w4Y6xoc9zo4ijFw3v4I8yoo8y4sztXo5xIY9zYw7xYc7yYkpnmkhiVoqoWwml2QonGgqoWswr3Y0uX0ijV0nmWYom2c6x4gjj14mmGUjkF8xsXckk2EllmMspm83wIM8zo01u382voE3v4EtqXEurHMspW8qoGskkmAvrXQwr3UspW4zt3wvrXUxsnguq3MnmmYrpG4mmWUsp3Apn2oqomwnnWgnm2c+z40poGsik2AjkmAjlGArqnAnmWUmmmcmm2YnnWconmk6x4g7yYk3v4Iqom03wIQrpG04w4Y4xIY1voE4w4UsqHA3wYMzt3w0u383wYMuqnMurHQvq3M2wIIuq3M3woMzun0wsncytns0vYAxsnkhj+2PAAAA/HRSTlMANHu47P//xzoCTr78///////MaAUSk////ygX/+RHCOnX/z7v8iLbjQxg+0Mb/7L/V9CvhC6oovbgw5pv/T4+Pj4/Pj7/+fn5+fn5+ff5+fn5+fn6+OXT//////////////////////////////////////////////////////////////////////////////////////////////////j///////////////////////////////////////v///////////////////////////////m0nn1eKu4e5tjX2fGKp5aNv99y6WjLXrPR6suI1vHu/+vf/8fbSdjCAAAZs0lEQVR4AezcZXbjTBSE4Ta0jK0ySwrHzBzGjxmH9r+TiSHs5J4cabiewALeH8Y6V31ioXAkqq1oLBxPKFotmUobWwM6Y7K5fEE9RsVS1sliyXK9yJp6iNYjG1ncoc3mlrqPtiMbGvc5OyF1D5WMxkNmd13RHfmyhcdMSdGtStXGCnZtTdG1esPFKto01RK1UgarubGWooWmo7GaHV1TNNfuZPEEXa4omolXy3iKdrvqCvV2XTxJ92eVqDAY4hn9tlKKmkY/WymvFI06WQiVKBT1wEqC9bELVhJsTwxYSTJ1NSsJEsl0Bqwk2Nv0wEqC4tiAlQSJfTkSK4U9i5UkyY4NVhKs7XhgJUErNgQrSQ4MWEkSdi1WkmwdZsBKgvpRH6wkaB0bsJLkxGhWkpyWLQhYqXtog5XE2UQfL9I/Vd+c7ZTBy3hN9c0puZqVJHk7C1YSxGtlgJXk2QQribMJB6wkaRrNSpJ2Jguwkjx4YyVxNjEEK/mcTciVOJuQK3HwtsBKIfmRm5XWcy5YKYDZBCuFXc1K8iN3Bqzkf/DGSsWYA1YSJA7kSKwU7lusJEke2mAl/4/cIu/kqx+8GfjmDdTX7WSoWSmA2QQrbcmP3Ky0Jg/eWKmVcsBKkpLRrCTJexZYSVCp2WAlQa/hgpUCGLyxUtPRrCRpn2XBSv5nE6xUlwdvrFQYGLCSZOpoVgrgkZuVQtEyWMn3nSCwUkEevLFSIuxoVpKM0jaC50345ZvMi6mvSDE3xIfg7XLw9o1VCvc1KwXw5RsryXeCWCnRyjlgJcmB0awkOXUssJL/R25Wku8EgZVaxw5YKYA7Qax0Ks8mWKlbK4OV/N8JYqVWyoCVAhi8sVLetsBK/u8EsZI8mwArbQ8MPoby0fnLXMxdXlwufHfP93M/rPbjQ/G1ovKnOdT4GKyffl74ZWb2/45fH/tt5veFP2b+XPjryt9L/1z7d+G/pf9nXi28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"
  },
  "description": "Use this tag for writing data to the Supabase.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "mode",
    "displayName": "Mode",
    "radioItems": [
      {
        "value": "insert",
        "displayValue": "Insert"
      },
      {
        "value": "upsert",
        "displayValue": "Upsert"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "insert"
  },
  {
    "type": "TEXT",
    "name": "url",
    "displayName": "Project URL",
    "simpleValueType": true,
    "help": "A RESTful endpoint for querying and managing your database.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "apiKey",
    "displayName": "Project API key",
    "simpleValueType": true,
    "help": "Use service_role API key. This key can bypass Row Level Security or create custom for your needs.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "tableName",
    "displayName": "Table Name",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "dataListGroup",
    "displayName": "Data",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "name": "dataList",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Field Name",
            "name": "name",
            "isUnique": true,
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Field Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "displayName": "Logs Settings",
    "name": "logsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const JSON = require('JSON');
const getRequestHeader = require('getRequestHeader');
const logToConsole = require('logToConsole');
const getContainerVersion = require('getContainerVersion');
const sendHttpRequest = require('sendHttpRequest');

const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = getRequestHeader('trace-id');

const postUrl = data.url + '/rest/v1/' + data.tableName;

let postBody = {};
data.dataList.forEach(d => {postBody[d.name] = d.value;});


if (isLoggingEnabled) {
    logToConsole(JSON.stringify({
        'Name': 'SupabaseWriter',
        'Type': 'Request',
        'TraceId': traceId,
        'EventName': data.mode,
        'RequestMethod': 'POST',
        'RequestUrl': postUrl,
        'RequestBody': postBody,
    }));
}

sendHttpRequest(postUrl, (statusCode, headers, body) => {
    if (isLoggingEnabled) {
        logToConsole(JSON.stringify({
            'Name': 'SupabaseWriter',
            'Type': 'Response',
            'TraceId': traceId,
            'EventName': data.mode,
            'ResponseStatusCode': statusCode,
            'ResponseHeaders': headers,
            'ResponseBody': body,
        }));
    }

    if (statusCode >= 200 && statusCode < 400) {
        data.gtmOnSuccess();
    } else {
        data.gtmOnFailure();
    }
}, {headers: generateHeaders(), method: 'POST'}, JSON.stringify(postBody));

function generateHeaders() {
    let headers = {
        'Content-Type': 'application/json',
        'apikey': data.apiKey,
        'Authorization': 'Bearer ' + data.apiKey,
    };

    if (data.mode === 'upsert') {
        headers['Prefer'] = 'resolution=merge-duplicates';
    }

    return headers;
}

function determinateIsLoggingEnabled() {
    const containerVersion = getContainerVersion();
    const isDebug = !!(
        containerVersion &&
        (containerVersion.debugMode || containerVersion.previewMode)
    );

    if (!data.logType) {
        return isDebug;
    }

    if (data.logType === 'no') {
        return false;
    }

    if (data.logType === 'debug') {
        return isDebug;
    }

    return data.logType === 'always';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 02/01/2023, 14:36:01


